{
  "model651cat": {
    "description": "Data structure for Catalonia Model 651 (donations).",
    "metadata": {
      "source": "tax_models/mod651cat/mod651cat.pdf",
      "formCode": "651",
      "jurisdiction": "Catalonia",
      "language": "ca-ES",
      "lastUpdated": "2025-12-21"
    },
    "structure": [
      {
        "id": "encabezado",
        "label": "Encabezado",
        "order": 0,
        "required": false,
        "fields": [
          {
            "id": "fecha_devengo",
            "label": "Fecha de devengo",
            "type": "string",
            "order": 1,
            "required": false,
            "description": "Header date of accrual.",
            "format": "YYYY-MM-DD",
            "validationRegex": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          {
            "id": "fecha_documento",
            "label": "Fecha del documento",
            "type": "string",
            "order": 2,
            "required": false,
            "description": "Document date shown in the header.",
            "format": "YYYY-MM-DD",
            "validationRegex": "^\\d{4}-\\d{2}-\\d{2}$"
          }
        ]
      },
      {
        "id": "causante",
        "label": "Donante",
        "order": 1,
        "required": true,
        "fields": [
          {
            "id": "dni_nif",
            "label": "NIF del donante",
            "type": "string",
            "order": 1,
            "required": true,
            "description": "NIF/NIE of the donor (persona.dni_nif).",
            "validationRegex": "^[0-9XYZ][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$|^[XYZ][0-9]{7}[A-Z]$|^[ABCDEFGHJNPQRSUVW][0-9]{7}[0-9A-J]$"
          },
          {
            "id": "nombre_completo",
            "label": "Nombre completo del donante",
            "type": "string",
            "order": 2,
            "required": true,
            "description": "Nombre + apellidos (persona.nombre + persona.apellidos)."
          },
          {
            "id": "fecha_nacimiento",
            "label": "Fecha de nacimiento del donante",
            "type": "string",
            "order": 3,
            "required": false,
            "description": "Fecha de nacimiento (persona.fecha_nacimiento).",
            "format": "YYYY-MM-DD",
            "validationRegex": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          {
            "id": "tiene_discapacidad",
            "label": "Tiene discapacidad",
            "type": "boolean",
            "order": 4,
            "required": false,
            "description": "Derived from persona.info_discapacidad.porcentaje IS NOT NULL."
          },
          {
            "id": "porcentaje_discapacidad",
            "label": "Porcentaje de discapacidad",
            "type": "number",
            "order": 5,
            "required": false,
            "description": "Porcentaje de discapacidad (info_discapacidad.porcentaje).",
            "format": "integer",
            "dependsOn": "tiene_discapacidad"
          }
        ]
      },
      {
        "id": "beneficiario",
        "label": "Donatario",
        "order": 2,
        "required": true,
        "fields": [
          {
            "id": "dni_nif",
            "label": "NIF del donatario",
            "type": "string",
            "order": 1,
            "required": true,
            "description": "NIF/NIE of the donee (persona.dni_nif).",
            "validationRegex": "^[0-9XYZ][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$|^[XYZ][0-9]{7}[A-Z]$|^[ABCDEFGHJNPQRSUVW][0-9]{7}[0-9A-J]$"
          },
          {
            "id": "nombre_completo_razon_social",
            "label": "Nombre completo o razon social",
            "type": "string",
            "order": 2,
            "required": true,
            "description": "Nombre + apellidos (persona.nombre + persona.apellidos)."
          },
          {
            "id": "fecha_nacimiento",
            "label": "Fecha de nacimiento",
            "type": "string",
            "order": 3,
            "required": true,
            "description": "Fecha de nacimiento (persona.fecha_nacimiento).",
            "format": "YYYY-MM-DD",
            "validationRegex": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          {
            "id": "parentesco",
            "label": "Parentesco",
            "type": "string",
            "order": 4,
            "required": true,
            "description": "Relacion personal (relacion_causante_familiar.relacion_personal)."
          },
          {
            "id": "grupo_parentesco",
            "label": "Grupo de parentesco",
            "type": "string",
            "order": 5,
            "required": false,
            "description": "Group derived from parentesco.",
            "values": ["I", "II", "III", "IV"]
          },
          {
            "id": "patrimonio_preexistente",
            "label": "Patrimonio preexistente",
            "type": "number",
            "order": 6,
            "required": false,
            "description": "Patrimonio preexistente (patrimonio_preexistente.patrimonio_valor).",
            "format": "decimal"
          },
          {
            "id": "tiene_discapacidad",
            "label": "Tiene discapacidad",
            "type": "boolean",
            "order": 7,
            "required": false,
            "description": "Derived from persona.info_discapacidad.porcentaje IS NOT NULL."
          },
          {
            "id": "porcentaje_discapacidad",
            "label": "Porcentaje de discapacidad",
            "type": "number",
            "order": 8,
            "required": false,
            "description": "Porcentaje de discapacidad (info_discapacidad.porcentaje).",
            "format": "integer",
            "dependsOn": "tiene_discapacidad"
          }
        ]
      },
      {
        "id": "tramitante",
        "label": "Tramitante",
        "order": 3,
        "required": false,
        "fields": [
          {
            "id": "dni_nif",
            "label": "NIF del tramitante",
            "type": "string",
            "order": 1,
            "required": false,
            "description": "NIF/NIE of the presenter (persona.dni_nif).",
            "validationRegex": "^[0-9XYZ][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$|^[XYZ][0-9]{7}[A-Z]$|^[ABCDEFGHJNPQRSUVW][0-9]{7}[0-9A-J]$"
          },
          {
            "id": "nombre_completo_firmante",
            "label": "Nombre completo del firmante",
            "type": "string",
            "order": 2,
            "required": false,
            "description": "Nombre + apellidos (persona.nombre + persona.apellidos)."
          },
          {
            "id": "fecha_firma",
            "label": "Fecha de firma",
            "type": "string",
            "order": 3,
            "required": false,
            "description": "Signature date (use current date if needed).",
            "format": "YYYY-MM-DD",
            "validationRegex": "^\\d{4}-\\d{2}-\\d{2}$"
          },
          {
            "id": "acuerdo_declaracion",
            "label": "Acuerdo de declaracion",
            "type": "boolean",
            "order": 4,
            "required": false,
            "description": "Checkbox declaring that the copy matches the original.",
            "default": true
          }
        ]
      },
      {
        "id": "pago",
        "label": "Pago",
        "order": 4,
        "required": false,
        "fields": [
          {
            "id": "metodo_pago",
            "label": "Metodo de pago",
            "type": "string",
            "order": 1,
            "required": false,
            "description": "Payment method (invented field)."
          },
          {
            "id": "importe",
            "label": "Importe",
            "type": "number",
            "order": 2,
            "required": false,
            "description": "Payment amount in EUR.",
            "format": "decimal"
          }
        ]
      },
      {
        "id": "liquidacion",
        "label": "Liquidacion",
        "order": 5,
        "required": false,
        "fields": [
          {
            "id": "base_imposable",
            "label": "Base imponible",
            "type": "number",
            "order": 1,
            "required": false,
            "description": "Base imponible.",
            "format": "decimal"
          },
          {
            "id": "base_imposable_real",
            "label": "Base imponible real",
            "type": "number",
            "order": 2,
            "required": false,
            "description": "Base imponible real.",
            "format": "decimal"
          },
          {
            "id": "base_liquidable",
            "label": "Base liquidable",
            "type": "number",
            "order": 3,
            "required": false,
            "description": "Base liquidable.",
            "format": "decimal"
          },
          {
            "id": "base_liquidable_real",
            "label": "Base liquidable real",
            "type": "number",
            "order": 4,
            "required": false,
            "description": "Base liquidable real.",
            "format": "decimal"
          },
          {
            "id": "cuota_tributaria",
            "label": "Cuota tributaria",
            "type": "number",
            "order": 5,
            "required": false,
            "description": "Cuota tributaria.",
            "format": "decimal"
          },
          {
            "id": "cuota_integra",
            "label": "Cuota integra",
            "type": "number",
            "order": 6,
            "required": false,
            "description": "Cuota integra.",
            "format": "decimal"
          },
          {
            "id": "cuota_liquida",
            "label": "Cuota liquida",
            "type": "number",
            "order": 7,
            "required": false,
            "description": "Cuota liquida.",
            "format": "decimal"
          },
          {
            "id": "cuota_liquidada_anterior",
            "label": "Cuota liquidada anteriormente",
            "type": "number",
            "order": 8,
            "required": false,
            "description": "Cuota liquidada anteriormente.",
            "format": "decimal"
          },
          {
            "id": "cuota_resultante",
            "label": "Cuota resultante",
            "type": "number",
            "order": 9,
            "required": false,
            "description": "Cuota resultante.",
            "format": "decimal"
          },
          {
            "id": "intereses_demora",
            "label": "Intereses de demora",
            "type": "number",
            "order": 10,
            "required": false,
            "description": "Intereses de demora.",
            "format": "decimal"
          },
          {
            "id": "recargo",
            "label": "Recargo",
            "type": "number",
            "order": 11,
            "required": false,
            "description": "Recargo.",
            "format": "decimal"
          },
          {
            "id": "total_ingresar",
            "label": "Total a ingresar",
            "type": "number",
            "order": 12,
            "required": false,
            "description": "Total a ingresar.",
            "format": "decimal"
          }
        ]
      },
      {
        "id": "reducciones",
        "label": "Reducciones",
        "order": 6,
        "required": false,
        "type": "array",
        "description": "Reductions applied to the taxable base.",
        "fields": {
          "casillaReal": {
            "type": "integer",
            "required": true,
            "description": "Box number for real reduction (301-312)."
          },
          "casillaTeorica": {
            "type": "integer",
            "required": true,
            "description": "Box number for theoretical reduction (401-412)."
          },
          "clave": {
            "type": "string",
            "required": true,
            "description": "Reduction key (snake_case)."
          },
          "etiqueta": {
            "type": "string",
            "required": true,
            "description": "Reduction label."
          },
          "importeReal": {
            "type": "number",
            "required": false,
            "description": "Real reduction amount.",
            "format": "decimal",
            "default": 0.0
          },
          "importeTeorico": {
            "type": "number",
            "required": false,
            "description": "Theoretical reduction amount.",
            "format": "decimal",
            "default": 0.0
          }
        }
      },
      {
        "id": "totalesReducciones",
        "label": "Totales de reducciones",
        "order": 7,
        "required": false,
        "fields": [
          {
            "id": "total_reducciones_real",
            "label": "Total reducciones real",
            "type": "number",
            "order": 1,
            "required": false,
            "description": "Total of real reductions.",
            "format": "decimal"
          },
          {
            "id": "total_reducciones_teorica",
            "label": "Total reducciones teorica",
            "type": "number",
            "order": 2,
            "required": false,
            "description": "Total of theoretical reductions.",
            "format": "decimal"
          },
          {
            "id": "total_reducciones_aplicadas",
            "label": "Total reducciones aplicadas",
            "type": "number",
            "order": 3,
            "required": false,
            "description": "Total applied reductions.",
            "format": "decimal"
          }
        ]
      }
    ],
    "example": {
      "encabezado": {
        "fecha_devengo": "",
        "fecha_documento": ""
      },
      "causante": {
        "dni_nif": "12345678Z",
        "nombre_completo": "Jose Perez Garcia",
        "fecha_nacimiento": "1985-04-20",
        "tiene_discapacidad": true,
        "porcentaje_discapacidad": 33
      },
      "beneficiario": {
        "dni_nif": "12345678Z",
        "nombre_completo_razon_social": "Jose Perez Garcia",
        "fecha_nacimiento": "1990-05-12",
        "parentesco": "Hijo/a",
        "grupo_parentesco": "",
        "patrimonio_preexistente": 150000,
        "tiene_discapacidad": true,
        "porcentaje_discapacidad": 33
      },
      "tramitante": {
        "dni_nif": "12345678Z",
        "nombre_completo_firmante": "Jose Perez Garcia",
        "fecha_firma": "",
        "acuerdo_declaracion": true
      },
      "pago": {
        "metodo_pago": "",
        "importe": null
      },
      "liquidacion": {
        "base_imposable": null,
        "base_imposable_real": null,
        "base_liquidable": null,
        "base_liquidable_real": null,
        "cuota_tributaria": null,
        "cuota_integra": null,
        "cuota_liquida": null,
        "cuota_liquidada_anterior": null,
        "cuota_resultante": null,
        "intereses_demora": null,
        "recargo": null,
        "total_ingresar": null
      },
      "reducciones": [],
      "totalesReducciones": {
        "total_reducciones_real": null,
        "total_reducciones_teorica": null,
        "total_reducciones_aplicadas": null
      }
    },
    "notes": {
      "fieldMappings": "tax_models/mod651cat/data_models/mod651cat_field_mappings.json",
      "idNaming": "Field IDs do not include section prefixes; names use snake_case and match DB fields when available."
    }
  }
}
